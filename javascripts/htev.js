$(function(){var f={};f.htevdata=htevdata;f.initOptions=function(){var a,b="";for(a=htevdata.first;a<=htevdata.last;a++)b+="<option value="+a+">"+a+"</option>";$("#startseason").html(b).val(htevdata.first);$("#endseason").html(b).val(htevdata.last);$("#gobutton").click(this.calculateChances)};f.initTable=function(){$("#htevtable_container").empty().html('<table id="htevtable"><thead></thead><tbody></tbody></table>')};f.getCumulativeChances=function(a){var b=a.length,c=[100-a[0],a[0]],d,e,f,l,g;for(d=1;d<b;d++){l=a[d]/100;f=1-l;g=[c[0]*f];for(e=1;e<=d;e++)g[e]=c[e]*f+c[e-1]*l;g[d+1]=c[d]*l;c=g}return c};f.getTableHeader=function(a){var b,c="Team Name;Seas;Best;Wins;Mean;Med;Mode;Luck".split(";"),d="Team Name;Number of Seasons in Division;Highest Chance to Win Title;Times Won Title;Mean (Expected Number of Titles);Median (Expected Number of Titles);Mode (Expected Number of Titles);Luck Level (+ lucky, - unlucky)".split(";"),e="<tr>";for(b=1;b<=a;b++)c.push(b+"+"),d.push("Chance to win "+b+" or more titles");a=c.length;for(b=0;b<a;b++)e+='<th title="'+d[b]+'">'+c[b]+"</th>";return e+"</tr>"};f.getTableRow=function(a,b){var c,d=a[8],e=d.length,f=[a[0],a[1],a[2]+"%",a[3],a[4].toFixed(2),a[5],a[6],a[7].toFixed(0)];for(c=0;c<b;c++)f[8+c]=c<e?Math.abs(d[c]).toFixed(2)+"%":"0.00%";return"<tr><td>"+f.join("</td><td>")+"</td></tr>"};f.calculateChances=function(){var a=Number($("#startseason").val()),b=Number($("#endseason").val()),c=a-htevdata.first,d=b-htevdata.first,e={},s={},l={},g,h,m,n,p,k,q,u,v,t=0,r;if(a<htevdata.first||b>htevdata.last||a>b)alert("That makes no sense.");else{for(a=c;a<=d;a++){g=htevdata.seasons[a];for(b=1;8>=b;b++)m=g[b].slice(),h=m[0],m[0]=a+c,e[h]||(e[h]=[],s[h]=[],l[h]=0),e[h].push(m);l[htevdata.winners[a]]++}console.log(l);for(h in e){n=e[h];c=n.length;b=l[h];g=m=0;d=[];p=[];for(a=c;a--;)k=n[a],k=k[4],k>m&&(m=k),g+=k,p.push(k);g/=100;r=f.getCumulativeChances(p);k=v=n=p=0;q=100;u=[];for(a=0;a<=c;a++)q-=r[a],u[a]=q,r[a]>p&&(p=r[a],k=a),!n&&50>q&&(n=1,v=a);d[0]=htevdata.names[h];d[1]=c;d[2]=m;d[3]=b;d[4]=g;d[5]=v;d[6]=k;d[7]=100*(b-g)/c;d[8]=u;for(a=t+1;a<=c;a++).005<=r[a]&&(t=a);s[h]=d}f.initTable();e=f.getTableHeader(t);$("#htevtable thead").html(e);e="";for(a in s)e+=f.getTableRow(s[a],t);$("#htevtable tbody").html(e);$("#htevtable").tablesorter();$("#htevtable").trigger("update");setTimeout(function(){$("#htevtable").trigger("sorton",[[[3,2],[4,2]]])},1)}};f.initOptions();f.calculateChances()});
